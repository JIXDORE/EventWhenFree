<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ตารางกิจกรรม | เวอร์ชันเว็บ</title>
  <meta name="description" content="ตารางกิจกรรม 5 รูปแบบ สลับได้ด้วยไอคอน Responsive + โหมดมืด/สว่าง ปรับสี Light ให้สด มีปุ่มแก้ไข เพิ่ม/ลบ/บันทึก กิจกรรม พร้อมจำข้อมูล" />
  <style>
    :root{
      --bg: #f5f7ff;
      --card: #ffffff;
      --text: #2b2e34;
      --muted: #667085;
      --ring: #7aa2ff;
      --p1: #b9ddff;   /* blue */
      --p2: #bff7d0;   /* green */
      --p3: #ffd1e2;   /* pink */
      --p4: #ffe2a8;   /* amber */
      --p5: #dac5ff;   /* purple */
      --shadow: 0 14px 30px rgba(0,0,0,.08);
      --radius: 18px;
      --accent: #3b82f6;
      --thead: #eef6ff;
      --dur: 280ms;
      --ease: cubic-bezier(.4,0,.2,1);
    }
    /* Dark */
    body.dark{
      --bg: #14161b;
      --card: #1f2025;
      --text: #f5f5f6;
      --muted: #a1a1aa;
      --ring: #7aa2ff;
      --shadow: 0 14px 30px rgba(0,0,0,.45);
      --thead: #23242b;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", "Noto Sans", Helvetica, Arial, Tahoma, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 600px at -10% -10%, #ffd9e6 0%, transparent 45%),
                  radial-gradient(1200px 600px at 110% -10%, #d6f7ff 0%, transparent 45%),
                  radial-gradient(1200px 600px at 50% 120%, #e5ffd6 0%, transparent 45%),
                  var(--bg);
      display:grid; grid-template-rows: auto 1fr;
      transition: background .25s ease, color .2s ease;
    }
    body.dark{
      background:
        radial-gradient(900px 500px at -10% -10%, rgba(80,120,255,.12) 0%, transparent 50%),
        radial-gradient(900px 500px at 110% -10%, rgba(255,120,200,.10) 0%, transparent 50%),
        var(--bg);
    }

    header{ position:sticky; top:0; z-index:10; backdrop-filter:saturate(180%) blur(6px); background: rgba(255,255,255,.65); border-bottom:1px solid rgba(0,0,0,.06); }
    body.dark header{ background: rgba(22,22,26,.6); border-bottom:1px solid rgba(255,255,255,.08) }

    .wrap{max-width:1120px; margin:0 auto; padding:12px 16px}
    .brand{display:flex; align-items:center; gap:12px; justify-content:space-between}
    .brand h1{font-size:18px; margin:0}
    .brand small{color:var(--muted)}

    .toggleDark, .editBtn, .addRowBtn, .cancelBtn, .smallBtn{
      border:none; border-radius:12px; padding:8px 14px; cursor:pointer; background:var(--card); color:var(--text); box-shadow:var(--shadow);
    }
    .primary{ background: var(--accent); color: #fff; }
    .danger{ background: #ef4444; color:#fff }
    .ghost{ background: transparent; box-shadow:none; border:1px solid rgba(0,0,0,.08) }
    body.dark .ghost{ border:1px solid rgba(255,255,255,.14) }
    .toggleDark:focus-visible, .editBtn:focus-visible, .addRowBtn:focus-visible, .cancelBtn:focus-visible, .smallBtn:focus-visible{ outline:2px solid var(--ring); outline-offset:2px }

    main{display:grid; grid-template-columns: 1fr; gap:16px; padding:16px}
    @media(min-width:900px){ main{grid-template-columns: 280px 1fr} }

    .side{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:12px; display:grid; gap:10px; align-self:start; position:sticky; top:76px; }
    .iconBtn{ display:flex; align-items:center; gap:12px; width:100%; border:none; border-radius:16px; padding:12px; background:#ffffff; color:var(--text); cursor:pointer; text-align:left; transition: transform .04s ease, background .2s ease, box-shadow .2s; box-shadow: 0 2px 0 rgba(0,0,0,.04); }
    .iconBtn:hover{ transform: translateY(-1px); box-shadow: 0 8px 16px rgba(0,0,0,.08) }
    body.dark .iconBtn{ background:#23252d; box-shadow: 0 2px 0 rgba(0,0,0,.3) }
    body.dark .iconBtn:hover{ box-shadow: 0 10px 18px rgba(0,0,0,.45) }
    .iconBtn[aria-current="page"]{ outline:2px solid rgba(59,130,246,.35); background: rgba(59,130,246,.08) }
    body.dark .iconBtn[aria-current="page"]{ outline:2px solid rgba(59,130,246,.45); background:#0f172a }

    .swatch{width:40px; height:40px; border-radius:12px; display:grid; place-items:center; border:1px solid rgba(0,0,0,.06)}
    .swatch svg{ color:#334155 }

    /* Light swatch vibrant */
    button[data-key="morningOT"] .swatch{ background:#b9ddff }
    button[data-key="morningNoOT"] .swatch{ background:#bff7d0 }
    button[data-key="night"] .swatch{ background:#dac5ff }
    button[data-key="nightNoOT"] .swatch{ background:#dac5ff }
    button[data-key="sundayLight"] .swatch{ background:#ffe2a8 }
    button[data-key="dayOffFull"] .swatch{ background:#ffd1e2 }

    /* Dark swatch vivid */
    body.dark button[data-key="morningOT"] .swatch{ background:#3b82f6; border:1px solid rgba(255,255,255,.25) }
    body.dark button[data-key="morningNoOT"] .swatch{ background:#22c55e; border:1px solid rgba(255,255,255,.25) }
    body.dark button[data-key="night"] .swatch{ background:#a855f7; border:1px solid rgba(255,255,255,.25) }
    body.dark button[data-key="nightNoOT"] .swatch{ background:#a855f7; border:1px solid rgba(255,255,255,.25) }
    body.dark button[data-key="sundayLight"] .swatch{ background:#f59e0b; border:1px solid rgba(255,255,255,.25) }
    body.dark button[data-key="dayOffFull"] .swatch{ background:#ec4899; border:1px solid rgba(255,255,255,.25) }
    body.dark .swatch svg{ color:#fff; filter: drop-shadow(0 1px 1px rgba(0,0,0,.65)); }

    .iconBtn .label{display:flex; flex-direction:column}
    .iconBtn .label strong{font-size:14.5px}

    .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px }
    .titleRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap }
    .titleRow h2{ margin:0; font-size:20px }
    .badge{ padding:6px 10px; border-radius:999px; font-size:12px; background:#f3f5fb; color:var(--muted) }
    body.dark .badge{ background:#23242b }

    .tableWrap{ overflow:auto; border-radius:12px; border:1px solid rgba(0,0,0,.06) }
    body.dark .tableWrap{ border:1px solid rgba(255,255,255,.08) }
    table{ width:100%; border-collapse:collapse; font-size:14.5px }
    thead th{ position:sticky; top:0; background:var(--thead); text-align:left; padding:12px; border-bottom:1px solid rgba(0,0,0,.06) }
    body.dark thead th{ border-bottom:1px solid rgba(255,255,255,.08) }
    tbody td{ padding:12px; border-bottom:1px dashed rgba(0,0,0,.06); vertical-align:top }
    body.dark tbody td{ border-bottom:1px dashed rgba(255,255,255,.08) }
    tbody tr:nth-child(2n){ background:#fcfdff }
    body.dark tbody tr:nth-child(2n){ background:#1c1d22 }

    /* inputs in edit mode */
    .rowInputs{ display:grid; grid-template-columns: 180px 1fr auto; gap:8px; align-items:center }
    .rowInputs input{ width:100%; padding:8px 10px; border-radius:10px; border:1px solid rgba(0,0,0,.14); background:#fff; color:var(--text) }
    body.dark .rowInputs input{ background:#1c1d22; border:1px solid rgba(255,255,255,.14); color:var(--text) }
    .smallBtn{ padding:6px 10px; border-radius:10px }

    .dock{ position:sticky; bottom:0; z-index:15; display:grid; grid-template-columns:repeat(6,1fr); gap:8px; padding:10px; }
    .dock .iconBtn{ justify-content:center; padding:10px; }
    .dock .iconBtn .label{ display:none }
    .dock .iconBtn .swatch{ width:42px; height:42px }
    @media(min-width:900px){ .dock{ display:none } }
    @media(min-width:900px){ .side{ display:grid } }
    @media(max-width:899px){ .side{ display:none } }

    footer{ color:var(--muted); font-size:12px; padding:8px 16px 24px; text-align:center }

    body[data-theme="morningOT"]{ background: radial-gradient(900px 420px at 10% 0%, rgba(59,130,246,.12) 0%, transparent 60%), var(--bg); }
    body[data-theme="morningNoOT"]{ background: radial-gradient(900px 420px at 90% 0%, rgba(34,197,94,.12) 0%, transparent 60%), var(--bg); }
    body[data-theme="night"]{ background: radial-gradient(900px 420px at 50% 0%, rgba(168,85,247,.12) 0%, transparent 60%), var(--bg); }
    body[data-theme="sundayLight"]{ background: radial-gradient(900px 420px at 0% 40%, rgba(245,158,11,.12) 0%, transparent 60%), var(--bg); }
    body[data-theme="dayOffFull"]{ background: radial-gradient(900px 420px at 100% 40%, rgba(236,72,153,.12) 0%, transparent 60%), var(--bg); }
    body.dark[data-theme]{ background:
      radial-gradient(700px 320px at 10% -5%, rgba(59,130,246,.14) 0%, transparent 60%),
      radial-gradient(700px 320px at 90% -5%, rgba(236,72,153,.10) 0%, transparent 60%),
      var(--bg); }

    /* Animations */
    @media (prefers-reduced-motion: reduce) {
      .anim-enter, .anim-leave, .swatchPulse { animation: none !important; transition: none !important; }
    }
    .anim-leave-fade{ animation: leaveFade var(--dur) var(--ease) forwards; }
    .anim-enter-fade{ animation: enterFade var(--dur) var(--ease) forwards; }
    .anim-leave-card{ animation: leaveLift var(--dur) var(--ease) forwards; }
    .anim-enter-card{ animation: enterDrop var(--dur) var(--ease) forwards; }
    @keyframes leaveFade { from{opacity:1;transform:translateY(0);} to{opacity:0;transform:translateY(12px);} }
    @keyframes enterFade { from{opacity:0;transform:translateY(-8px);} to{opacity:1;transform:translateY(0);} }
    @keyframes leaveLift { from{opacity:1;transform:translateY(0) scale(1);} to{opacity:0;transform:translateY(10px) scale(.98);} }
    @keyframes enterDrop { from{opacity:0;transform:translateY(-8px) scale(.98);} to{opacity:1;transform:translateY(0) scale(1);} }
    .swatchPulse{ position: relative; }
    .swatchPulse::after{ content:""; position:absolute; inset:0; border-radius:12px; background: currentColor; opacity:.15; animation: pulse1 450ms ease-out; }
    @keyframes pulse1 { from{ transform: scale(1); opacity:.25; } to{ transform: scale(1.25); opacity:0; } }

    @media print{ header, .side, .dock, footer{display:none} body{background:#fff} .card{box-shadow:none; border:1px solid #ddd} }
  </style>
</head>
<body data-theme="morningOT">
  <svg width="0" height="0" class="hidden" aria-hidden="true">
    <symbol id="i-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="4"/>
      <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
    </symbol>
    <symbol id="i-moon" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.5A9 9 0 0 1 11.5 3a8 8 0 1 0 9.5 9.5Z"/></symbol>
    <symbol id="i-feather" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 7a7 7 0 0 0-10 0L3 14l7 7 7-7a7 7 0 0 0 0-10Z"/>
      <path d="M14 7l3 3M7 14l3 3M3 14h8"/>
    </symbol>
    <symbol id="i-book" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 19V5a2 2 0 0 1 2-2h12v16H6a2 2 0 0 0-2 2Z"/>
      <path d="M6 17h12"/>
    </symbol>
    <symbol id="i-trash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="3 6 5 6 21 6"/>
      <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
    </symbol>
    <symbol id="i-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 5v14M5 12h14"/>
    </symbol>
    <symbol id="i-edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 20h9"/>
      <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5Z"/>
    </symbol>
  </svg>

  <header>
    <div class="wrap brand">
      <div style="display:flex; align-items:center; gap:10px">
        <div class="swatch" style="background:var(--p1); border-radius:10px; width:32px; height:32px; display:grid; place-items:center"><svg width="18" height="18"><use href="#i-book"/></svg></div>
        <h1>ตารางกิจกรรม</h1>
      </div>
      <div style="display:flex; align-items:center; gap:8px">
        <small id="modeHint" aria-live="polite">โหมด: Dark</small>
        <button class="toggleDark" id="toggleDark" aria-label="สลับโหมด">☀️ Light</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <aside class="side" aria-label="สลับตารางแบบเดสก์ท็อป">
      <button class="iconBtn" data-key="morningOT" aria-current="page">
        <div class="swatch"><svg width="22" height="22" aria-hidden="true"><use href="#i-sun"/></svg></div>
        <div class="label"><strong>กะเช้า</strong></div>
      </button>
      <button class="iconBtn" data-key="morningNoOT">
        <div class="swatch"><svg width="22" height="22" aria-hidden="true"><use href="#i-sun"/></svg></div>
        <div class="label"><strong>กะเช้า (ไม่มีโอที)</strong></div>
      </button>
      <button class="iconBtn" data-key="night">
        <div class="swatch"><svg width="22" height="22" aria-hidden="true"><use href="#i-moon"/></svg></div>
        <div class="label"><strong>กะดึก</strong></div>
      </button>
      <button class="iconBtn" data-key="nightNoOT">
        <div class="swatch"><svg width="22" height="22" aria-hidden="true"><use href="#i-moon"/></svg></div>
        <div class="label"><strong>กะดึก (ไม่มีโอที)</strong></div>
      </button>
      <button class="iconBtn" data-key="sundayLight">
        <div class="swatch"><svg width="22" height="22" aria-hidden="true"><use href="#i-feather"/></svg></div>
        <div class="label"><strong>หยุดกะดึก</strong></div>
      </button>
      <button class="iconBtn" data-key="dayOffFull">
        <div class="swatch"><svg width="22" height="22" aria-hidden="true"><use href="#i-book"/></svg></div>
        <div class="label"><strong>หยุดกะเช้า</strong></div>
      </button>
    </aside>

    <section class="card" id="content" aria-live="polite">
      <div class="titleRow">
        <h2 id="title">กะเช้า</h2>
        <div style="display:flex; gap:8px">
          <button class="ghost editBtn" id="editBtn"><svg width="18" height="18" style="vertical-align:-3px"><use href="#i-edit"/></svg> แก้ไข</button>
        </div>
      </div>
      <div class="tableWrap" style="margin-top:12px">
        <table aria-describedby="title">
          <thead>
            <tr><th style="width:32%">เวลา</th><th>กิจกรรม</th></tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div id="editActions" style="display:none; margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
        <button class="addRowBtn smallBtn" id="addRow"><svg width="16" height="16" style="vertical-align:-3px"><use href="#i-plus"/></svg> เพิ่มกิจกรรม</button>
        <button class="primary smallBtn" id="saveEdit">บันทึก</button>
        <button class="cancelBtn smallBtn" id="cancelEdit">ยกเลิก</button>
      </div>
    </section>
  </main>

  <nav class="dock wrap" aria-label="สลับตารางแบบมือถือ">
    <button class="iconBtn" data-key="morningOT" aria-current="page" aria-label="กะเช้า">
      <div class="swatch"><svg width="22" height="22"><use href="#i-sun"/></svg></div>
    </button>
    <button class="iconBtn" data-key="morningNoOT" aria-label="กะเช้า ไม่มีโอที">
      <div class="swatch"><svg width="22" height="22"><use href="#i-sun"/></svg></div>
    </button>
    <button class="iconBtn" data-key="night" aria-label="กะดึก">
      <div class="swatch"><svg width="22" height="22"><use href="#i-moon"/></svg></div>
    </button>
    <button class="iconBtn" data-key="nightNoOT" aria-label="กะดึก ไม่มีโอที">
      <div class="swatch"><svg width="22" height="22"><use href="#i-moon"/></svg></div>
    </button>
    <button class="iconBtn" data-key="sundayLight" aria-label="หยุดกะดึก">
      <div class="swatch"><svg width="22" height="22"><use href="#i-feather"/></svg></div>
    </button>
    <button class="iconBtn" data-key="dayOffFull" aria-label="หยุดกะเช้า">
      <div class="swatch"><svg width="22" height="22"><use href="#i-book"/></svg></div>
    </button>
  </nav>

  <footer>
    <div class="wrap">เวอร์ชันสีสดขึ้นใน Light + โหมดแก้ไข เพิ่ม/ลบ/บันทึก พร้อมจำข้อมูลในเครื่อง</div>
  </footer>

  <script>
    const defaultSchedules = {
      morningOT: { theme: 'morningOT', title: 'กะเช้า', rows: [
        ['04:25 – 05:30','เตรียมตัวไปทำงาน'],['06:00 – 18:15','ทำงาน'],['19:15','ถึงห้อง'],['19:30 – 19:45','สมาธิ'],['19:50 – 20:10','โปรเจกต์เล็ก (แต่งเรื่อง/โค้ด/ฝึกพูด สลับวัน)'],['20:10 – 20:30','เกม/พัก'],['20:30 – 20:45','เขียนบันทึก'],['21:00 เป็นต้นไป','พัก/นอน'],] },
      morningNoOT: { theme: 'morningNoOT', title: 'กะเช้า (ไม่มีโอที)', rows: [
        ['04:25 – 05:30','เตรียมตัวไปทำงาน'],['06:00 – 14:15','ทำงาน'],['15:15','ถึงห้อง'],['15:30 – 15:45','สมาธิ'],['15:50 – 16:20','โปรเจกต์เล็ก (แต่งเรื่อง/โค้ด/ฝึกพูด)'],['16:20 – 17:00','พัก/เกม'],['17:00 – 17:30','ฝึกพูด (สั้นๆ)'],['17:30 – 18:00','เกม/พักสายตา'],['18:00 – 18:30','VS Code / โค้ดเล็กๆ'],['18:30 – 19:00','กินข้าว/พัก'],['19:00 – 19:30','เขียนบันทึก'],['19:30 เป็นต้นไป','พัก/กิจกรรมเบา → เข้านอน'],] },
      night: { theme: 'night', title: 'กะดึก', rows: [
        ['16:25 – 17:30','เตรียมตัวไปทำงาน'],['18:00 – 06:15','ทำงาน'],['07:15','ถึงห้อง'],['07:20 – 07:35','สมาธิ'],['07:35 – 07:55','โปรเจกต์เล็ก (บันทึก/จดไอเดีย 2–3 บรรทัด)'],['08:00 – 08:30','อาบน้ำ/เตรียมตัวนอน'],['08:30 – 15:00','นอนยาว'],['15:00 – 16:00','ตื่น/พัก/กินข้าว'],['16:00 – 18:00','พักผ่อนเบาๆ (ฟังเพลง เกมมือถือ)'],['18:00 เป็นต้นไป','วันธรรมดา → เริ่มกะดึกใหม่ | วันเสาร์ → เข้าตารางวันอาทิตย์'],] },
      nightNoOT: { theme: 'night', title: 'กะดึก (ไม่มีโอที)', rows: [
        ['16:25 – 17:30','เตรียมตัวไปทำงาน'],['18:00 – 06:00','ทำงาน'],['07:00','ถึงห้อง'],['07:05 – 07:20','สมาธิ'],['07:20 – 07:40','โปรเจกต์เล็ก (บันทึก/จดไอเดีย 2–3 บรรทัด)'],['07:40 – 08:10','อาบน้ำ/เตรียมตัวนอน'],['08:10 – 15:00','นอนยาว'],['15:00 – 16:00','ตื่น/พัก/กินข้าว'],['16:00 – 18:00','พักผ่อนเบาๆ (ฟังเพลง เกมมือถือ)'],['18:00 เป็นต้นไป','วันธรรมดา → เริ่มกะดึกใหม่ | วันเสาร์ → เข้าตารางวันอาทิตย์'],] },
      sundayLight: { theme: 'sundayLight', title: 'หยุดกะดึก', rows: [
        ['07:15 – 07:30','สมาธิสั้นๆ + อาบน้ำ'],['07:30 – 14:30','นอนยาวพักร่าง'],['14:30 – 15:00','ตื่น/กินข้าว'],['15:00 – 16:00','กิจกรรมเบาๆ (ยืดเส้น, ฟังเพลง, เกม)'],['16:00 – 17:00','แต่งเรื่องเล็กๆ (เพิ่มฉากเดียวหรือไอเดียสั้นๆ)'],['17:00 – 18:00','เกม/พัก'],['18:00 – 19:00','ฝึกพูดสั้นๆ 2–3 ประโยค'],['19:00 – 20:00','VS Code / โค้ดเล็กๆ ง่ายๆ'],['20:00 – 21:00','เขียนบันทึก + พักอิสระ'],['21:00 – 22:00','เตรียมตัวนอน (เพื่อกะเช้าวันจันทร์)'],] },
      dayOffFull: { theme: 'dayOffFull', title: 'หยุดกะเช้า', rows: [
        ['09:00 – 09:30','ตื่น / ล้างหน้า / จัดที่นอน'],['09:30 – 10:00','ฝึกพูด 2–3 ประโยค'],['10:00 – 11:00','ศึกษาหุ้น'],['11:00 – 11:15','พักยืดเส้น'],['11:15 – 12:00','ฝึกใช้ VS Code'],['12:00 – 12:45','ฝึกเขียนโค้ด'],['12:45 – 13:15','กินข้าวกลางวัน'],['13:15 – 14:00','ฝึกแต่งเรื่อง'],['14:00 – 14:30','เกมมือถือ'],['14:30 – 15:15','ศึกษาหุ้นต่อ'],['15:15 – 15:30','พักสายตา'],['15:30 – 16:00','ฝึกใช้ VS Code รอบบ่าย'],['16:00 – 16:45','ฝึกเขียนโค้ดต่อ'],['16:45 – 17:15','ฝึกพูดรอบเย็น'],['17:15 – 18:00','เกมมือถือ'],['18:00 – 18:30','พักอิสระ'],['18:30 – 19:00','เขียนบันทึก'],['19:00 – 21:00','เกม/ดูหนัง'],['21:00 – 21:30','อ่าน/ฟังอะไรเบาๆ'],['21:30 – 22:00','เตรียมตัวนอน'],] },
    };

    // merge with custom saved
    const saved = JSON.parse(localStorage.getItem('customSchedules') || 'null');
    const schedules = saved ? Object.fromEntries(Object.keys(defaultSchedules).map(k=>[k,{...defaultSchedules[k], ...(saved[k]||{})}])) : JSON.parse(JSON.stringify(defaultSchedules));

    const titleEl = document.getElementById('title');
    const tbodyEl = document.getElementById('tbody');
    const buttons = Array.from(document.querySelectorAll('button.iconBtn'));
    const toggleBtn = document.getElementById('toggleDark');
    const modeHint = document.getElementById('modeHint');
    const editBtn = document.getElementById('editBtn');
    const addRowBtn = document.getElementById('addRow');
    const saveBtn = document.getElementById('saveEdit');
    const cancelBtn = document.getElementById('cancelEdit');
    const editActions = document.getElementById('editActions');
    const wrap = document.querySelector('.tableWrap');

    let editing = false;
    let currentKey = 'morningOT';

    function rowInput(time='', desc=''){
      return `<div class="rowInputs"><input type="text" value="${time}" placeholder="เวลา เช่น 09:00 – 10:00"/> <input type="text" value="${desc}" placeholder="กิจกรรม"/> <button class="smallBtn danger" title="ลบแถว"><svg width="16" height="16" style="vertical-align:-3px"><use href="#i-trash"/></svg> ลบ</button></div>`;
    }

    function applyContent(data){
      if(editing){
        tbodyEl.innerHTML = data.rows.map(([t,a]) => `<tr><td colspan="2">${rowInput(t,a)}</td></tr>`).join('');
        editActions.style.display = 'flex';
      }else{
        tbodyEl.innerHTML = data.rows.map(([t,a]) => `<tr><td><strong>${t}</strong></td><td>${a}</td></tr>`).join('');
        editActions.style.display = 'none';
      }
    }

    function render(key){
      const data = schedules[key];
      if(!data) return;
      currentKey = key;
      document.body.setAttribute('data-theme', data.theme);
      titleEl.textContent = data.title;

      const activeBtn = buttons.find(b=> b.dataset.key===key);
      const sw = activeBtn && activeBtn.querySelector('.swatch');
      if(sw){ sw.classList.add('swatchPulse'); setTimeout(()=> sw.classList.remove('swatchPulse'), 450); }

      buttons.forEach(b=> b.setAttribute('aria-current', b.dataset.key===key ? 'page' : 'false'));
      localStorage.setItem('scheduleKey', key);
      location.hash = key;

      wrap.classList.remove('anim-enter-fade','anim-enter-card');
      wrap.classList.add('anim-leave-card');
      wrap.addEventListener('animationend', ()=>{
        wrap.classList.remove('anim-leave-card');
        applyContent(data);
        requestAnimationFrame(()=>{
          wrap.classList.add('anim-enter-fade');
          wrap.addEventListener('animationend', ()=> wrap.classList.remove('anim-enter-fade'), {once:true});
        });
      }, {once:true});
    }

    function enterEdit(){
      editing = true;
      editBtn.innerHTML = '<svg width="18" height="18" style="vertical-align:-3px"><use href="#i-edit"/></svg> โหมดแก้ไข';
      const data = schedules[currentKey]; applyContent(data); editActions.style.display='flex';
    }
    function exitEdit(){
      editing = false;
      editBtn.innerHTML = '<svg width="18" height="18" style="vertical-align:-3px"><use href="#i-edit"/></svg> แก้ไข';
      const data = schedules[currentKey]; applyContent(data); editActions.style.display='none';
    }

    buttons.forEach(btn=>{
      btn.addEventListener('click', ()=> { if(editing) exitEdit(); render(btn.dataset.key); });
      btn.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); if(editing) exitEdit(); render(btn.dataset.key); } });
    });
    editBtn.addEventListener('click', ()=>{ editing ? exitEdit() : enterEdit(); });

    tbodyEl.addEventListener('click', (e)=>{
      if(!editing) return;
      const btn = e.target.closest('button');
      if(btn && btn.classList.contains('danger')){
        const row = btn.closest('tr');
        row.parentNode.removeChild(row);
      }
    });

    addRowBtn.addEventListener('click', ()=>{
      if(!editing) return; 
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="2">${rowInput('','')}</td>`;
      tbodyEl.appendChild(tr);
      const inputs = tr.querySelectorAll('input');
      if(inputs[0]) inputs[0].focus();
    });

    cancelBtn.addEventListener('click', ()=>{ exitEdit(); });

    saveBtn.addEventListener('click', ()=>{
      if(!editing) return;
      const rows = Array.from(tbodyEl.querySelectorAll('.rowInputs')).map(div=>{
        const [t,a] = div.querySelectorAll('input');
        return [t.value.trim(), a.value.trim()];
      }).filter(r=> r[0]!=='' || r[1]!=='' );
      schedules[currentKey].rows = rows;
      const minimal = JSON.parse(localStorage.getItem('customSchedules')||'{}');
      minimal[currentKey] = { rows };
      localStorage.setItem('customSchedules', JSON.stringify(minimal));
      exitEdit();
    });

    // Theme init
    const storedTheme = localStorage.getItem('theme');
    if(storedTheme){ if(storedTheme === 'dark') document.body.classList.add('dark'); }
    else { document.body.classList.add('dark'); localStorage.setItem('theme','dark'); }
    toggleBtn.textContent = document.body.classList.contains('dark') ? '☀️ Light' : '🌙 Dark';
    modeHint.textContent = `โหมด: ${document.body.classList.contains('dark') ? 'Dark' : 'Light'}`;

    toggleBtn.addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      toggleBtn.textContent = isDark ? '☀️ Light' : '🌙 Dark';
      modeHint.textContent = `โหมด: ${isDark ? 'Dark' : 'Light'}`;
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // Initial schedule
    const savedKey = localStorage.getItem('scheduleKey');
    const initialFromHash = location.hash?.replace('#','');
    const initial = (initialFromHash && defaultSchedules[initialFromHash]) ? initialFromHash : (savedKey && defaultSchedules[savedKey] ? savedKey : 'morningOT');

    (function firstPaint(k){
      const data = schedules[k];
      document.body.setAttribute('data-theme', data.theme);
      titleEl.textContent = data.title;
      buttons.forEach(b=> b.setAttribute('aria-current', b.dataset.key===k ? 'page' : 'false'));
      applyContent(data);
      localStorage.setItem('scheduleKey', k);
      location.hash = k;
    })(initial);

    window.addEventListener('hashchange', ()=>{ const k = location.hash.replace('#',''); if(defaultSchedules[k]) { if(editing) exitEdit(); render(k);} });
  </script>
</body>
</html>

